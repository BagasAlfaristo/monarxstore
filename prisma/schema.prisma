// prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum OrderStatus {
  PENDING
  PAID
  FAILED
}

enum ProductItemType {
  ACCOUNT
  CODE
}

enum PaymentMethod {
  ALIPAY
  WECHAT
  MANUAL
}

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  passwordHash String
  name         String?
  isAdmin      Boolean  @default(false)

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  orders       Order[]
}

model Product {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  description String
  price       Float
  currency    String
  imageUrl    String
  featured    Boolean  @default(false)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  orders      Order[]
  items       ProductItem[]
}

model Order {
  id            String        @id @default(cuid())
  productSlug   String
  email         String
  notes         String?
  status        OrderStatus   @default(PENDING)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  amount        Int           @default(0)
  currency      String        @default("USD")
  paymentMethod PaymentMethod? @default(ALIPAY)

  product       Product       @relation(fields: [productSlug], references: [slug])
  userId        String?
  user          User?         @relation(fields: [userId], references: [id])
  items         ProductItem[]
}

model ProductItem {
  id        String          @id @default(cuid())
  product   Product         @relation(fields: [productId], references: [id])
  productId String

  type      ProductItemType
  value     String
  note      String?

  isUsed    Boolean         @default(false)
  usedAt    DateTime?

  order     Order?          @relation(fields: [orderId], references: [id])
  orderId   String?

  createdAt DateTime        @default(now())
}
